<html>
<head>
	<!--<script src="file:///home/chronos/u-8c76189d6d79b89d2195035f0cec044aa6fc2aff/MyFiles/Downloads/elgesis_folder/plotly_chrome/plotly-latest.min.js"></script>-->
	<!--<script src="file:///home/chronos/u-8c76189d6d79b89d2195035f0cec044aa6fc2aff/MyFiles/Downloads/elgesis_folder/ultraObject_chrome/ultraObject.js"></script>-->
	<script src="http://24.189.66.225/backend/plotly"></script>
	<script src="http://24.189.66.225/backend/ultraObject"></script>
</head>
<body>
</body>
    <script>


    var parcats_FL_0_i = {
        forLoop_0_i:0,
        forLoopLength:3,
        fn:function(   dev_obj   ){
            var element11 = document.createElement("div")
            document.body.appendChild(element11)
            var node11 = document.querySelector('div')
            id11 = document.createAttribute("id")
            id11.value = 'myDiv' +parcats_FL_0_i.forLoop_0_i
            element11.setAttributeNode(id11)
        },
        args: {}
    }
    ultraObject.forLoop(   parcats_FL_0_i   )
    

    var randomData =  ultraObject.iterableObject()
    var parcats_FL_1_i = {
        forLoop_0_i:0,
        forLoopLength:15,
        fn:function(   dev_obj   ){
            
            randomData.add({
                value:ultraObject.XHR[   ultraObject.scope[   parcats_XHR_0_i ]   ].data[0]
            })
            ultraObject.XHR[   ultraObject.scope[   parcats_XHR_0_i ]   ].data[0] = {}
            // impt for the pointer to point to a new memory address to avoid your referencing problem
            parcats_FL_2_i.forLoopLength = Object.keys(   randomData[parcats_FL_1_i.forLoop_0_i ]   ).length,
            parcats_FL_2_i.args.total = 0
            ultraObject.forLoop(   parcats_FL_2_i    )
            ultraObject.XHR[   ultraObject.scope[   parcats_XHR_0_i ]   ].data[0].total = parcats_FL_2_i.args.total
            
        },
        args: {}
    }
    var parcats_FL_2_i = {
        forLoop_0_i:0,
        fn:function(   dev_obj   ){
            
            ultraObject.XHR[   ultraObject.scope[   parcats_XHR_0_i ]   ].data[0][   Object.keys(   randomData[parcats_FL_1_i.forLoop_0_i]    )[   parcats_FL_2_i.forLoop_0_i   ]   ] = Math.floor(  Math.random() *10 )
            parcats_FL_2_i.args.total += ultraObject.XHR[   ultraObject.scope[   parcats_XHR_0_i ]   ].data[0][   Object.keys(   randomData[parcats_FL_1_i.forLoop_0_i]    )[   parcats_FL_2_i.forLoop_0_i   ]   ]
            
        },
        args: {}
    }
    var parcats_FL_3_i = {
        forLoop_0_i:0,
        fn:function(   dev_obj   ){
            parcats_FL_3_i.args.target.push(   parcats_FL_3_i.args.source[   parcats_FL_3_i.forLoop_0_i   ]   )
        },
        args: {}
    }
    

    
    /*making the XHR for the db data from interrogation*/  //{
var parcats_XHR_0_i
ultraObject.endpoint({
    xhttp:ultraObject.iterify({iterify:[new XMLHttpRequest()]}),
    instruct:'XMLHttpRequest',
    eventName:'load',
    eventHandler:()=>{
        parcats_XHR_0_i  =  ultraObject.scope.add(   {value:ultraObject.XHR.abelast[ultraObject.XHR.abelast.length -1]}   )
        ultraObject.XHR[   ultraObject.scope[   parcats_XHR_0_i ]   ].data = JSON.parse(   ultraObject.XHR[   ultraObject.scope[   parcats_XHR_0_i ]   ][0].response   )
    },
    protocol:`POST`,
    target:`http://24.189.66.225/database/query`,
    asyncBool:false,
    body:`SELECT * FROM interrogation_PLOTLY;`
})
// }  /**/

function generateParcat(   dev_obj   ) {
        var gd = dev_obj.gd
        // Preprocess Data
        var carsData = []
        ultraObject.sort({
            target: dev_obj.data,
            algorithm:'bubble',
            compare:function(   dev_obj   ){
                
                
                if(   dev_obj.val[dev_obj.index].total < dev_obj.val[dev_obj.index+ 1].total    ){
                    
                    
                    return 'true'
                    
                    
                }
                
                
            },
            result:'true'
        })
        parcats_FL_3_i.forLoopLength = dev_obj.data.length
        parcats_FL_3_i.args.target = carsData
        parcats_FL_3_i.args.source = dev_obj.data
        ultraObject.forLoop(   parcats_FL_3_i   )
        var categoricalDimensions = dev_obj.labels.map(
          function(dimLabel) {
            // Extract column
            var values = carsData.map(function(row) {
              return row[dimLabel]
            });
    
            return {
              values: values,
              categoryorder:'category descending',
              label: dimLabel
            };
          }
        );
    
        // Colors
        var colorscale = [];
        var colors = new Int8Array(carsData.length);
        var color = []
        colors.map((x,i)=>{
            color.push(i/15)
            colorscale.push(   [i/15, 'rgb('+Math.floor(  Math.random() *255 ).toString()+','+Math.floor(  Math.random() *255 ).toString()+','+Math.floor(  Math.random() *255 ).toString()+')']   )
        })
        colorscale[0] = [0, "rgb(0,255,255)"]
        colorscale.push(   [1, "rgb(255,0,0)"]   )
        

    
        // Layout
        var layout = {
            width: dev_obj.dimensions.width,
            height: dev_obj.dimensions.height,
            hovermode: 'closest'
        };
    
        // Build Traces
        console.log(color)
        console.log(colorscale)
        console.log(categoricalDimensions)
        var traces = [
            {
            type: 'parcats',
            // domain: {
            //           x:[0,2],
            //           y: [0, 10.4],
            //           row:12,
            //           column:14
            //       },
            name:'interrogation parcat',
            hoverinfo:'all',
            arrangement:"freeform" ,
            sortpaths:"forward",
            dimensions:categoricalDimensions,
            line: {
                colorscale: colorscale,
                cmin: 0,
                cmax: 14,
                cauto:true,
                color: color,
                width:500,
                shape: 'hspline',
                showscale:true,
                colorbar:{
                    len:.5
                }
            },
            labelfont: {
                size: 12,
                family:"Overpass",
                color:"green"
            },
            domain:{
                x:[.5],
                y:[.2]
            }
            
            }
        ];
    
        // Make plot
        Plotly.newPlot(gd, traces, layout);
    
        // Update color on selection and click
    var update_color = function(points_data) {
        var new_color = color;
        var color_value = document.querySelector('input[name="rate"]:checked').value;
        console.log(color_value);
        var selection = []
        for(var i = 0; i < points_data.points.length; i++) {
          new_color[points_data.points[i].pointNumber] = color_value;
          selection.push(points_data.points[i].pointNumber);
        }
        // Update selected points in scatter plot
        Plotly.restyle(gd, {'marker.color': [new_color]}, 0)
        // Update color of selected paths in parallel categories diagram
        Plotly.restyle(gd,
                       {'line.color': [new_color]}, 1)
    };
    
        gd.on('plotly_selected', update_color);
        gd.on('plotly_click', update_color);
    }
var resolveDiv0 = new Promise((resolve,reject)=>{
    var gd = document.getElementById('myDiv0');
    var cdLabels = [
      'element',
      'parents',
      'siblings',
      'children',
      'total'

    
    ];
    

    
    
    
    /*generating a  random samplye*/  //{
    parcats_XHR_0_i  =  ultraObject.scope.add(   {value:ultraObject.XHR.abelast[ultraObject.XHR.abelast.length -1]}   )
    ultraObject.forLoop(   parcats_FL_1_i    )
    // }  /**/
    
    /*making my parcat*/ //{
    generateParcat({
        data:randomData,
        labels:cdLabels,
        gd, // es6 only
        dimensions:{
            height:800,
            width:1400
        }
        
    })
    // }  /**/
    
});

var resolveDiv1 = new Promise((resolve,reject)=>{
    var gd = document.getElementById('myDiv1');
    var cdLabels = [

    "element_tagname",
    "element_hidden",
    "element_classname",
    "element_id",
    "parents_exist",
    "parents_tagname",
    "parents_classname",
    "parents_id",
    "siblings_tagname",
    "children_classname",
    "children_id",
    'total'

    
    ];
    

    
    /*making my parcat*/ //{
    generateParcat({
        data:randomData,
        labels:cdLabels,
        gd, // es6 only
        dimensions:{
            height:1000,
            width:1700
        }
        
    })
    // }  /**/
    
});

var resolveDiv2 = new Promise((resolve,reject)=>{
    var gd = document.getElementById('myDiv2');
    var cdLabels = [
    "element",
    "element_tagname",
    "element_hidden",
    "element_classname",
    "element_id",
    "parents",
    "parents_exist",
    "parents_tagname",
    "parents_classname",
    "parents_id",
    "siblings",
    "siblings_tagname",
    "children",
    "children_classname",
    "children_id",
    'total'

    
    ];
    

    
    /*making my parcat*/ //{
    generateParcat({
        data:randomData,
        labels:cdLabels,
        gd, // es6 only
        dimensions:{
            height:1200,
            width:2000
        }
        
    })
    // }  /**/
    
});
    




            
</script>
</html>